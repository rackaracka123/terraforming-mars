services:
  # Backend - Pre-built Go server from ghcr.io
  backend:
    image: ghcr.io/rackaracka123/terraforming-mars-backend:latest
    container_name: tm-backend
    restart: unless-stopped
    environment:
      - TM_LOG_LEVEL=${TM_LOG_LEVEL:-info}
      - PORT=3001
    networks:
      - tm-network
    labels:
      - "traefik.enable=false"

  # Frontend - Pre-built React + Nginx from ghcr.io
  frontend:
    image: ghcr.io/rackaracka123/terraforming-mars-frontend:latest
    container_name: tm-frontend
    restart: unless-stopped
    depends_on:
      - backend
    networks:
      - tm-network
    labels:
      - "traefik.enable=false"

  # Cloudflare Tunnel
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: tm-cloudflared
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${TUNNEL_TOKEN}
    depends_on:
      - frontend
    networks:
      - tm-network
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      - "traefik.enable=false"

networks:
  tm-network:
    driver: bridge
    name: tm-network
